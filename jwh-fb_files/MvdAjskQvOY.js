/*1314820758,169776065*/

if (window.CavalryLogger) { CavalryLogger.start_js(["WVgkJ"]); }

var ChatUserInfos=window.ChatUserInfos||{};
var FriendLists=window.FriendLists||{get:function(a){var b=FriendLists._map;if(!b[a])b[a]=[];return b[a];},set:function(a,b){if(b===undefined)return;var c=FriendLists.get(a);c.length=0;c.push.apply(c,$A(b));},_map:{}};
var PresencePrivacy=window.PresencePrivacy||(function(){var b='/ajax/chat/privacy/settings.php';var a='/ajax/chat/privacy/default_presence.php';var g={};var f=true;var i={};var h=true;var n=[];var l=false;function d(q,r){if(q==Env.user)return;switch(r){case PresencePrivacy.WHITELISTED:case PresencePrivacy.BLACKLISTED:case PresencePrivacy.UNLISTED:break;default:return;}g[q]=r;PresencePrivacy.inform('privacy-changed');}function e(q){switch(q){case true:case false:break;default:return;}f=q;PresencePrivacy.inform('privacy-changed');}function o(r,q){n.push({uri:r,data:q});if(!l){next=n.shift();p(next.uri,next.data);}}function p(r,q){l=true;new AsyncRequest().setURI(r).setData(q).setHandler(m.bind(this,r,q)).setErrorHandler(j.bind(this)).setTransportErrorHandler(j.bind(this)).setFinallyHandler(k.bind(this)).setAllowCrossPageTransition(true).send();}function m(s,q,r){if(s===b){AvailableList.set(q.user,r.payload.user_availability);i[q.user]=q.setting;}else h=q.presence;}function j(q){f=h;copy_properties(g,i);n=[];PresencePrivacy.inform('privacy-changed');}function k(q){l=false;if(n.length>0){next=n.shift();p(next.uri,next.data);}}function c(t,q){var s=q.obj;if(s.event==='access_control_entry'){var r=s.data;d(r.target_id,r.setting);i[r.target_id]=r.setting;}else if(s.event==='default_presence'){e(s.data.presence);h=s.data.presence;}}return copy_properties(new Arbiter(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,init:function(q,r){f=h=q;g=copy_properties({},r);i=copy_properties({},r);l=false;this.inform('privacy-changed');Arbiter.subscribe(PresenceMessage.getArbiterMessageType('privacy_changed'),c.bind(this));},setDefaultPresence:function(r){h=f;e(r);var q={presence:r};o(a,q);return r;},getDefaultPresence:function(){return f;},get:function(q){return g[q]||PresencePrivacy.UNLISTED;},allows:function(q){return this.getDefaultPresence()?g[q]!=PresencePrivacy.BLACKLISTED:g[q]==PresencePrivacy.WHITELISTED;},set:function(r,s){i[r]=g[r];d(r,s);var q={user:r,setting:s};o(b,q);return s;},allow:function(q){var r=this.getDefaultPresence()?PresencePrivacy.UNLISTED:PresencePrivacy.WHITELISTED;return this.set(q,r);},disallow:function(q){var r=this.getDefaultPresence()?PresencePrivacy.BLACKLISTED:PresencePrivacy.UNLISTED;return this.set(q,r);},getMapForTest:function(){return g;},setMapForTest:function(q){g=q;}});})();
var ChatConfig=window.ChatConfig||(function(){var a={};return {get:function(c,b){return c in a?a[c]:b;},set:function(b){if(arguments.length>1){var c={};c[b]=arguments[1];b=c;}copy_properties(a,b);},getDebugInfo:function(){return a;}};})();
var AvailableList=window.AvailableList||(function(){var b=5;var e=60000;var f='/ajax/chat/buddy_list.php';var d=5000;var c=1800000;var a=.005;var zg=0;var zn=false;var y=0;var zf=false;var zd=null;var u=null;var k=null;var t=0;var s=0;var j=null;var ze={};var r=false;var zb={};var zc={};var x={};var l=null;var v={'0':2,'1':1,'-1':0,'2':3};var zh={0:-1,1:1,2:0,3:2};function o(){return Chat.isOnline()?(zn?zd:u):null;}function h(zp,zt,zq,zs){if(zp==Env.user)return;switch(zt){case AvailableList.OFFLINE:case AvailableList.IDLE:case AvailableList.ACTIVE:case AvailableList.MOBILE:break;default:return;}var zr=AvailableList.get(zp)!=zt;if(zq){zb[zp]=zt;zc[zp]=zs||(presence.getTime()+e);delete ze[zp];}else ze[zp]=zt;if(zr){zg++;if(!k)k=zi.defer();}}function w(zq,zr,zp){l({observer:presence.user,observee:zq,status:zr,latency:zp});}function zk(zp){j=zp;Arbiter.inform('buddylist/count-changed',zp);}function zl(zp){s=new Date();x=Object.from(zp);}function zj(zs){if(presence.isShutdown||!Chat.isOnline()){AvailableList._poller.stop();return;}t=new Date();var zq=false;if(new Date()-s>c)zq=true;zf=true;if(ChatConfig.get('chat_fullbuddylist')){var zp=[];for(var zr in ChatUserInfos)zp.push(zr);zs.setHandler(za).setErrorHandler(z).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:Env.user,popped_out:presence.poppedOut,available_user_info_ids:zp,force_render:true,fetch_mobile:zq}).setURI(f).setAllowCrossPageTransition(true);}else zs.setHandler(za).setErrorHandler(z).setTransportErrorHandler(z).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:Env.user,popped_out:presence.poppedOut,available_list:AvailableList.haveFullList?n():{},force_render:zn}).setURI(f).setAllowCrossPageTransition(true);}function za(zt){var zs=zt.getPayload();var zp=zs.buddy_list;if(!zp){z(zt);return;}presence.updateServerTime(zs.time);AvailableList.updateTime=presence.getTime();y=0;zf=false;if(zp.forcedRender)AvailableList.haveFullList=true;if(zp.availableCount!=null)zk(zp.availableCount);if(zp.mobile_friends!=null)zl(zp.mobile_friends);var zv=zp.userInfos;if(zv)copy_properties(ChatUserInfos,zv);var zr=zp.nowAvailableList;var zw=zp.wasAvailableIDs;if(ChatConfig.get('chat_fullbuddylist'))for(var zu in ze)if(AvailableList.get(zu)!==AvailableList.OFFLINE)zw.push(zu);if(zw){zw.forEach(function(zx){if(!(zr&&(zx in zr))&&(ze[zx]!=AvailableList.OFFLINE)&&((zx in zb)&&(zb[zx]==AvailableList.OFFLINE)))w(zx,AvailableList.OFFLINE,presence.getTime()+e-zc[zx]);ze[zx]=AvailableList.OFFLINE;});zi.defer();}r=zp.userIsIdle;zr&&AvailableList.addLegacyAvailableList(zr);if(zp.newAvailableList){AvailableList.presenceData=zp.newAvailableList;AvailableList.haveFullList=true;}for(var zq in zp.mobile_friends)if(ze[zq]&&ze[zq]!=AvailableList.ACTIVE)ze[zq]=AvailableList.MOBILE;zo();Arbiter.inform('buddylist/fl-changed',{flMode:zp.flMode,flData:zp.flData});presenceCookieManager.store();}function z(zp){if(presence.checkMaintenanceError(zp))return;y++;zf=false;if(y>=b){zk(0);Arbiter.inform('buddylist/update-error');}}function n(){var zp={};AvailableList.getAvailableIDs().forEach(function(zq){zp[zq]={i:AvailableList.isIdle(zq)?1:0};});return zp;}function zo(){if(AvailableList.haveFullList)Arbiter.inform('buddylist/updated');}function zi(){k=null;if(AvailableList.haveFullList)zk(AvailableList.getAvailableIDs().length);Arbiter.inform('buddylist/availability-changed');}function i(zp,zr){for(var zq in zp){var zt;var zs;if(zr){zt=v[zp[zq].ol];zs=zp[zq].exp;}else if(!zp[zq]){zt=AvailableList.OFFLINE;}else if(zp[zq].i){zt=AvailableList.IDLE;}else if(zp[zq].m){zt=AvailableList.MOBILE;}else zt=AvailableList.ACTIVE;h(zq,zt,zr,zs);zp[zq]&&zp[zq].fl&&FriendLists.set(zq,zp[zq].fl);}}function q(){zm();if(Chat.isOnline()){AvailableList.update();}else g();}function g(){AvailableList.haveFullList=false;t=0;s=0;j=null;ze={};zb={};zc={};x={};zg++;zi();}function zm(){AvailableList._poller&&AvailableList._poller.setTimePeriod(o());}function m(){var zp={};Chat.getActiveFriendChats().forEach(function(zt){var zs=AvailableList.get(zt);if(zs)zp[zt]={i:zs==AvailableList.IDLE?1:0,m:zs==AvailableList.MOBILE?1:0};});var zq={ac:j,ut:parseInt(AvailableList.updateTime*.001,10),ud:zd*.001,lc:0};var zr=AvailableList.getLegacyOverlay();if(!is_empty(zr))zq.uo=zr;if(!is_empty(zp))zq.al=zp;return zq;}function p(zq,zp){zp.chat_config=ChatConfig.getDebugInfo();zp.available_list_debug_info={};AvailableList.getAvailableIDs().forEach(function(zr){zp.available_list_debug_info[zr]=AvailableList.getDebugInfo(zr);});}return {OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,haveFullList:false,init:function(zw,zr,zv,zu,zs,zp,zq,zt){l=EagleEye.createLogger('presence-status',presence.sitevars.BUDDY_STATUS_LOG_FRAC||a);AvailableList.updateTime=zw;AvailableList.haveFullList=zr;if(zr&&zt)zl(zt);i(zv,true);AvailableList.addLegacyAvailableList(zp);zd=zu;u=zs;AvailableList._poller=new Poller(o(),zj,true);Arbiter.subscribe('chat-options/initialized',zm);zk(zq);Arbiter.subscribe('jslogger/dump',p);Arbiter.subscribe('presence/restarted',AvailableList.update);Arbiter.subscribe('chat/visibility-changed',q);Arbiter.subscribe('presence-cookie-manager/initialized',function(zx,zy){zy.register('bl',m);});if(ChatConfig.get('blackbird'))PresencePrivacy.subscribe('privacy-changed',zi);if(AvailableList.haveFullList){t=new Date();}else if(zn)AvailableList.update();Arbiter.inform('available-list/initialized',AvailableList,Arbiter.BEHAVIOR_PERSISTENT);},get:function(zp){if(zp==Env.user)return AvailableList.ACTIVE;if(ChatConfig.get('blackbird')&&!PresencePrivacy.allows(zp))return AvailableList.OFFLINE;var zq=AvailableList.OFFLINE;if(zp in zb&&(presence.getTime()<zc[zp]||!(zp in ze))){zq=zb[zp];}else if(zp in ze)zq=ze[zp];if(zq==AvailableList.OFFLINE)if(x[zp])zq=AvailableList.MOBILE;return zq;},isUserIdle:function(){return r;},isReady:function(){return AvailableList.haveFullList;},set:function(zq,zr,zp){zp&&FriendLists.set(zq,$A(zp));h(zq,zr,true);window.presence&&presence.doSync();},update:function(){if(new Date()-t<d){!zf&&zo.defer();return;}zn=true;zm();AvailableList._poller&&AvailableList._poller.requestNow();},getRev:function(){return zg;},isIdle:function(zp){return AvailableList.get(zp)==AvailableList.IDLE;},getCount:function(){return j;},getAvailableIDs:function(){var zp,zq=[];for(zp in ze)if(AvailableList.get(zp)!==AvailableList.OFFLINE)zq.push(zp);for(zp in zb){if(zp in ze)continue;if(AvailableList.get(zp)!==AvailableList.OFFLINE)zq.push(zp);}for(zp in x){if(zp in ze||zp in zb)continue;zq.push(zp);}return zq;},getLegacyOverlay:function(){var zq={};for(var zp in zb)if(zc[zp]>presence.getTime())zq[zp]={exp:zc[zp],fl:FriendLists.get(zp),ol:zh[zb[zp]]};return zq;},addLegacyOverlay:function(zp){i(zp,true);window.presence&&presence.doSync();},addLegacyAvailableList:function(zp){i(zp,false);},getDebugInfo:function(zp){var zq;if(ChatUserInfos[zp])zq=ChatUserInfos[zp].name;return {id:zp,presence:ze[zp],overlay:zb[zp],overlayTime:zc[zp],mobile:x[zp],name:zq};}};})();
if(!window.Chat){var Chat={openTab:function(a,b,d,c){if(window.External&&External.Chat&&External.Chat.openWindow)External.Chat.openWindow(a);if(ChatConfig.get('click_tracking'))this._trackOpenTabClick(a,c);Chat._withComponent('chatDisplay',function(e){e.focusTab(a,true,b,b,d);});},_trackOpenTabClick:function(b,c){if(c&&c=='ordered_list'||c=='more_online_friends'||c=='online_friends'||c=='typeahead'){var a={target:b,source:c};new AsyncSignal('/ajax/chat/ct.php',a).send();}},openMultichatTab:function(d,b,a,e,f,c){Chat._withComponent('chatDisplay',function(g){g.createMultichatTab(d,b,a,e,f,true,c);});},loadTabFragile:function(b,c,a,d){Chat._withComponent('chatDisplay',function(e){e.loadTabFragile(b,c,a,d);});},openBuddyList:function(){Chat._withComponent('buddyListNub',function(a){a.show();});},closeBuddyList:function(){Chat._withComponent('buddyListNub',function(a){a.hide();});},toggleSidebar:function(){Chat._withComponent('sidebar',function(a){a.toggle();});},goOnline:function(a){Arbiter.subscribe('chat-options/initialized',function(event,b){if(Chat.isOnline()){a&&a();}else{if(a)var c=Arbiter.subscribe('chat/visibility-changed',function(){Arbiter.unsubscribe(c);a();});b.sendVisibility(true);}});},isOnline:function(){return window.chatOptions&&chatOptions.visibility;},squelchTab:function(a,b){Chat._withComponent('chatDisplay',function(c){c.setSquelchedTab(a,true);c.closeTab(a);});},unsquelchTab:function(a){Chat._withComponent('chatDisplay',function(b){b.setSquelchedTab(a,false);});},enterErrorMode:function(a){Chat._withComponent('buddyList',function(b){b.enterErrorMode(a);});},getActiveChats:function(){if(!window.chatDisplay)return [];return keys(chatDisplay.tabs);},getActiveFriendChats:function(){var a=this.getActiveChats();return a.filter(function(b){return chatDisplay.tabs[b]&&chatDisplay.tabs[b].getPostType()=='friend';});},_componentInitEvents:{buddyList:'buddylist/initialized',chatDisplay:'chat-display/loaded',buddyListDisplay:'buddylist-display/initialized',buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'},_withComponent:function(b,a){Arbiter.subscribe(Chat._componentInitEvents[b],function(event,c){a(c);});}};Chat._withComponent("buddyList",function(a){Chat._buddyList=a;});copy_properties(Chat,{debugPrintUpdateOverlay:function(){Chat._withComponent('buddyList',function(a){a.debugPrintUpdateOverlay();});},updateUserInfo:function(a){Chat._buddyList&&Chat._buddyList.updateUserInfos(a);},setUserInfo:function(b,c,a){ChatUserInfos[b]=c;Chat._withComponent('buddyList',function(d){d.updateItemDisplay(b);a&&FriendLists.set(b,a);});}});}
PresenceMessage={STARTED:'presence/started',SHUTDOWN:'presence/shutdown',RESTARTED:'presence/restarted',WINDOW_RESIZED:'presence/window-resized',TAB_CLOSED:'presence/tab-closed',TAB_OPENED:'presence/tab-opened',PRESENCE_UPDATER_READY:'presence/updater-ready',getAppMessageType:function(a,b){return 'presence/app_message:'+a+':'+b;},getArbiterMessageType:function(a){return 'presence/message:'+a;}};
Dcode=function(){var a,d={},b={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};function c(){var f=[];for(var e in b){d[b[e]]=e;f.push(b[e]);}f.reverse();a=new RegExp(f.join("|"),'g');}return {encode:function(e){c();return encodeURIComponent(e).replace(/([_A-Z])|%../g,function(g,f){return f?'%'+f.charCodeAt(0).toString(16):g;}).toLowerCase().replace(a,function(f){return d[f];});},decode:function(e){return decodeURIComponent(e.replace(/[_A-Z]/g,function(f){return b[f];}));}};}();
Dcode_deprecated=function(){var a,d={},b={_:'%',A:'%22%3a',B:'%2c%22',C:'%2c%22sb%22%3a1%2c%22t%22%3a%7b%7d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',D:'%7b%22',E:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22blo%22%3a0%2c%22bvt%22%3a',F:'ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',G:'%2c%22ch%22%3a%7b%22h%22%3a%22channel',H:'%22%2c%22p%22%3a80%2c%22sub%22%3a%5b',I:'%7d%7d',J:'%7b%22v%22%3a2%2c%22time%22%3a1',K:'%2c%22lc%22%3a1%2c%22cvr%22%3a%7b%22r%22%3a1%2c%22ts%22%3a1',L:'%5d%2c%22p%5f',M:'%22%3a0%2c%22',N:'%22%3a%7b%22i%22%3a0%2c%22all%46lids%22%3a%5bnull%5d',O:'0000',P:'%22%3a1',Q:'%7d',R:'%2c%22pt%22%3a0%2c%22vis%22%3a0%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22blo%22%3a0%2c%22bvt%22%3a0%2c%22ct%22%3a0%2c%22sb%22%3a1%2c%22t%22%3a%7b%7d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%7d%2c2bl%22%3a%7b%22ac%22%3a0%2c%22ut',S:'%22%3a%7b%22ol%22%3a%2d1%2c%22exp%22%3a1',T:'fl%22%3a%5b%22%2d1%22%5d%2c%22all%46lids%22%3a%5b%22%2d1%22%5d',U:'ud%22%3a900%2c%22lc%22%3a0%2c%22cvr%22%3a%7b',V:'%2c%22ut%22%3a1',W:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls',X:'%2c%22lc%22%3a1%2c%22cvr%22%3a%7b%22r%22%3a0%2e',Y:'%22%3a%7b%22n%22%3a%22%',Z:'%2c%22ud%22%3a'};function c(){var f=[];for(var e in b){d[b[e]]=e;f.push(b[e]);}f.reverse();a=new RegExp(f.join("|"),'g');}return {encode:function(e){c();return encodeURIComponent(e).replace(/([_A-Z])|%../g,function(g,f){return f?'%'+f.charCodeAt(0).toString(16):g;}).toLowerCase().replace(a,function(f){return d[f];});},decode:function(e){return decodeURIComponent(e.replace(/[_A-Z]/g,function(f){return b[f];}));}};}();
function CookieManager(b,a){this.version=b;this.cookieName='presence';this.dictEncode=a;this.storers={};this.requireUserCookie=false;Arbiter.inform('presence-cookie-manager/initialized',this,Arbiter.BEHAVIOR_PERSISTENT);}CookieManager.prototype={register:function(b,a){this.storers[b]=a;},store:function(){var a=this._getCookie();if(a&&a.v&&this.version<a.v){presence.versionShutdown();return;}var b={v:this.version,time:parseInt(presence.getTime()*.001)};for(var d in this.storers)b[d]=this.storers[d]();var c=JSON.stringify(b);if(this.dictEncode)c='E'+Dcode.encode(c);if(!this.requireUserCookie||presence.hasUserCookie(false))setCookie(this.cookieName,c,null);},clear:function(){clearCookie(this.cookieName);},_getCookie:function(){try{var data=getCookie(this.cookieName);if(this.lastD===data){return this.lastV;}else{this.lastD=data;this.lastV=null;}if(data&&data.charAt(0)=='E'){data=Dcode.decode(data.substring(1));}else if(data&&data.charAt(0)=='D')data=Dcode_deprecated.decode(data.substring(1));if(data){this.lastV=JSON.parse(data);return this.lastV;}}catch(a){}return null;},getSubCookie:function(b){var a=this._getCookie();if(!a)return null;return a[b];},setCheckUserCookie:function(a){this.requireUserCookie=a;}};
function PresenceIndicator(){}PresenceIndicator.prototype={init:function(b,a,d){this._id=b;this._firstname=a;this._tooltip=d;this._image=DOM.scry(this._tooltip,'i')[0];this._previousAvail=null;this._subscriptions=[Arbiter.subscribe('available-list/initialized',function(){this._updateAvailability();this._updateVisibility();}.bind(this)),Arbiter.subscribe('buddylist/availability-changed',this._updateAvailability.bind(this)),Arbiter.subscribe('chat/visibility-changed',this._updateVisibility.bind(this))];var c=Event.listen(this._tooltip,'click',function(){if(this._previousAvail!=AvailableList.OFFLINE)Chat.openTab(this._id);}.bind(this));onleaveRegister(function(){c.remove();while(this._subscriptions.length)Arbiter.unsubscribe(this._subscriptions.pop());}.bind(this));},_updateAvailability:function(){if(!AvailableList.isReady())return;var c;var b;var a=AvailableList.get(this._id);if(a===this._previousAvail)return;this._previousAvail=a;switch(a){case AvailableList.OFFLINE:c=_tx("{name} is unavailable",{name:this._firstname});b='offline';break;case AvailableList.IDLE:c=_tx("{name} is idle",{name:this._firstname});b='idle';break;case AvailableList.ACTIVE:c=_tx("{name} is available",{name:this._firstname});b='online';break;case AvailableList.MOBILE:c=_tx("{name} is available on mobile",{name:this._firstname});b='mobile';break;default:throw new Error('Invalid availability');}TooltipLink.setTooltipText(this._tooltip,c);CSS.setClass(this._image,b);},_updateVisibility:function(){if(Chat.isOnline()){CSS.show(this._tooltip);}else CSS.hide(this._tooltip);}};