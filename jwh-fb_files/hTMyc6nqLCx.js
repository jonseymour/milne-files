/*1314756433,169775555*/

if (window.CavalryLogger) { CavalryLogger.start_js(["7aLhy"]); }

var GenderConst={UNKNOWN:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11};
function TypingDetector(a){this._input=a;this._ignoreKeys={};}TypingDetector.INACTIVE=0;TypingDetector.TYPING=1;TypingDetector.QUITTING=2;Class.mixin(TypingDetector,'Arbiter',{_timeout:7000,_currentState:TypingDetector.INACTIVE,init:function(){this.init=bagofholding;this.reset();Event.listen(this._input,'keyup',this._update.bind(this));onunloadRegister(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=TypingDetector.INACTIVE;},setIgnoreKeys:function(a){this._ignoreKeys=Object.from(a);},_onunload:function(){if(this._currentState==TypingDetector.TYPING)this._transition(TypingDetector.QUITTING);},_update:function(event){var a=Event.getKeyCode(event);var b=this._currentState;if(!this._ignoreKeys[a])if(Input.getValue(this._input).trim().length===0){if(b==TypingDetector.TYPING)this._transition(TypingDetector.INACTIVE);}else if(b==TypingDetector.TYPING){this._recordKeystroke();}else if(b==TypingDetector.INACTIVE){this._transition(TypingDetector.TYPING);this._recordKeystroke();}},_transition:function(a){this.reset();this._currentState=a;this.inform('change',a);},_recordKeystroke:function(){this._lastKeystrokeTime=+new Date();if(!this._checkTimer)this._checkTimer=this._checkTyping.bind(this).defer(this._timeout);},_checkTyping:function(){var a=this._lastKeystrokeTime+this._timeout;var b=+new Date();if(b>a){this._transition(TypingDetector.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=this._checkTyping.bind(this).defer(a-b+10);}}});
(function(){if(!window.channel){window.channel={};}else if(channel.OK)return;var a='presence/';copy_properties(channel,{ON_CONNECT:a+'connect',ON_IDLE:a+'idle',ON_SHUTDOWN:a+'shutdown',ON_INVALID_HISTORY:a+'invalid_history',ON_CONFIG:a+'config',OK:'ok',ERROR:'error',ERROR_CONN:'error_conn',ERROR_MAX:'error_max',ERROR_MISSING:'error_missing',ERROR_MSG_TYPE:'error_msg_type',ERROR_REFRESH:'error_refresh',ERROR_SHUTDOWN:'error_shutdown',ERROR_DOS:'error_dos',HINT_AUTH:'shutdown auth',HINT_CONN:'shutdown conn',HINT_MAINT:'shutdown maint',reason_Unknown:0,reason_AsyncError:1,reason_TooLong:2,reason_Refresh:3,reason_RefreshDelay:4,reason_UIRestart:5,reason_NeedSeq:6,reason_PrevFailed:7,reason_IFrameLoadGiveUp:8,reason_IFrameLoadRetry:9,reason_IFrameLoadRetryWorked:10,reason_PageTransitionRetry:11,reason_IFrameLoadMaxSubdomain:12,reason_NoChannelInfo:13,reason_NoChannelHost:14,reason_ChannelUnknown:100,reason_ChannelNoCUser:101,reason_ChannelInvalidCUser:102,reason_ChannelInvalidChanstr:103,reason_ChannelChDistribTimeout:104,reason_ChannelGetChannelOther:105,reason_ChannelNodeShutdown:106,reason_ChannelTermination:107,reason_ChannelUserMismatch:108,reason_ChannelUserMismatchShady:109,reason_ChannelBadXs:110,reason_ChannelSeqNeg:111,reason_ChannelSeqTooBig:112,reason_ChannelSeqTooSmall:113,reason_ChannelUnexpectedJoin:114,reason_ChannelInvalidXsCookie:115,reason_ChannelRelocate:116,reason_ChannelWrongPartition:117,getArbiterType:function(b){return a+'message:'+b;}});})();
(function(){if(window.channel_cookie)return;window.channel_cookie={subdomainIndex:null,init:function(){var a=presenceCookieManager.getSubCookie('ch');this.retryInterval=presenceCookieManager.getSubCookie('ri')||0;if(!channel.getConfig('nosubdomain')){this.subdomainIndex=0;if(a&&a.sub){for(var b=0;b<a.sub.length;b++)if(!a.sub[b]){this.subdomainIndex=b;break;}if(b==a.sub.length)if(b==channel_manager.MAX_SUBDOMAINS&&URI().isSecure()){this.subdomainIndex=null;presence.error('channel: iframe max subdomains reached');channel_manager._sendIframeError(ChannelRebuildReasons.IFrameLoadMaxSubdomain);}else this.subdomainIndex=a.sub.length;}}presenceCookieManager.register('ch',this.getInfo.bind(this));var c=(function(){this._clearSubdomain=true;presenceCookieManager.setCheckUserCookie(true);presence.doSync(true);}).bind(this);if(typeof window.onpageshow!='undefined'){Event.listen(window,'pagehide',c);}else onunloadRegister(c);},getInfo:function(){var b={};var c=channel.getConfig('host');var e=channel.getConfig('port');if(c){if(null!==this.subdomainIndex){var a=presenceCookieManager.getSubCookie('ch');var f=(a&&a.sub)?a.sub:[];var d=f.length;f[this.subdomainIndex]=this._clearSubdomain?0:1;b.sub=f.map(function(g){return g?1:0;});}b[channel.getConfig('user_channel')]=channel.getConfig('seq',0);}b.ri=this.retryInterval;return b;}};})();
(function(){if(!window.channel){window.channel={};}else if(channel.init)return;copy_properties(channel,{inner:function(){return this.manager.transport._iframe.contentWindow.transport;},_sitevars:{},_config:{userActive:new Date()|0,sessionID:(Math.random()*2147483648|0).toString(16)},init:function(){channel_cookie.init();this._config.subdomainIndex=channel_cookie.subdomainIndex;this.log=bind(this,'_log','log');this.error=bind(this,'_log','error');this.warn=bind(this,'_log','warn');if(typeof(UserActivity)!='undefined')UserActivity.subscribe(function(){this._config.userActive=new Date().getTime();}.bind(this));},_log:function(b,c){var d=this.manager&&this.manager.transport;var a='channel2:'+(d?(d.logName+':'):'');if(b=='log'){return false;}else if(b=='warn'){return presence.warn(a+c);}else if(b=='error')return presence.error(a+c);},log:function(a){this._log('log',a);},warn:function(a){this._log('warn',a);},error:function(a){this._log('error',a);},configure:function(){$A(arguments).each(copy_properties.bind(null,this._config));Arbiter.inform(channel.ON_CONFIG,this);},getConfig:function(b,a){return b in this._config?this._config[b]:a;}});})();
var Dock=copy_properties(new Arbiter(),{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,stateItems:[],init:function(a){this.init=bagofholding;this.rootEl=a;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();ChatQuietLinks.silence(this.rootEl);Event.listen(a,'click',this._onClick.bind(this));Event.listen(window,'resize',this._onWindowResize.bind(this));Arbiter.subscribe('page_transition',this._onPageTransition.bind(this));Toggler.subscribe(['show','hide'],function(e,d){var b=d.getActive();if(!DOM.contains(a,b))return;if(CSS.hasClass(b,'fbNub')){this.notifyNub(b,e);if(e==='show')this._resizeNubFlyout(b);}else{var c=Parent.byClass(b,'fbNubFlyout');if(c)CSS.conditionClass(c,'menuOpened',e==='show');}}.bind(this));this._adjustTooltips();this.registerStateItems();this.inform('init',{},Arbiter.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return (this.viewportDimensions=Vector2.getViewportDimensions());},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+Vector2.getElementDimensions(this.rootEl).y;var b=ge('pageHead');if(b){var a=CSS.getStyle(b,'position')==='fixed';this.flyoutHeightOffset+=Vector2.getElementPosition(b,a?'viewport':null).y+Vector2.getElementDimensions(b).y;}},toggle:function(b){var a=this._findFlyout(b);if(!a)return;this.subscribe('init',function(){Toggler.getInstance(b).toggle(b);});},show:function(a){this.subscribe('init',function(){Toggler.getInstance(a).show(a);});},showNub:function(b){CSS.show(b);var a=DOM.find(b,'a.fbNubButton');this._adjustTooltip(a);},hide:function(a){this.subscribe('init',function(){var b=Toggler.getInstance(a);DOM.contains(a,b.getActive())&&b.hide();});},hideNub:function(a){CSS.hide(a);this.hide(a);},setUseMaxHeight:function(b,a){CSS.conditionClass(b,'maxHeight',a!==false);this._resizeNubFlyout(b);},_resizeNubFlyout:function(i){var e=this._findFlyout(i);if(!e||!CSS.hasClass(i,'openToggler'))return;var j=DOM.find(e,'div.fbNubFlyoutOuter');var g=DOM.find(j,'div.fbNubFlyoutInner');var b=DOM.find(g,'div.fbNubFlyoutBody');CSS.setStyle(b,'height','auto');var l=Vector2.getElementPosition(e,'viewport');var d=Vector2.getElementDimensions(e);var a=Vector2.getElementDimensions(b);var c=Vector2.getElementDimensions(b.firstChild);var h=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-l.y-d.y);CSS.setStyle(e,'max-height',h+'px');CSS.setStyle(j,'max-height',h+'px');d=Vector2.getElementDimensions(e);var m=Vector2.getElementDimensions(g);var k=m.y-a.y;if(d.y>k)CSS.setStyle(b,'height',(d.y-k)+'px');CSS.removeClass(e,'swapDirection');var f=Vector2.getElementPosition(e).x;CSS.conditionClass(e,'swapDirection',function(){if(f<0)return true;return (f+d.x>this.viewportDimensions.x);}.bind(this)());this.notifyNub(i,'resize');},resizeAllFlyouts:function(){var b=DOM.scry(this.rootEl,'div.fbNub.openToggler'),a=b.length;while(a--)this._resizeNubFlyout(b[a]);},_onClick:function(event){var c=event.getTarget(),b=Parent.byClass(c,'fbNub');if(b){if(Parent.byClass(c,'fbNubFlyoutTitlebar')){var a=Parent.byTag(c,'a');if(!a||!a.rel){this.hide(b);return false;}}this.notifyNub(b,'click');}},_onPageTransition:function(){this._flushDockState();},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();this._adjustTooltips();},_adjustTooltip:function(a){var b=DOM.scry(a,'span.uiTooltipWrap')[0];if(b&&!CSS.hasClass(b,'center')){var c=Vector2.getElementPosition(a).x;if(c){if(this._isRTL())c=this.viewportDimensions.x-c;CSS.conditionClass(b,'right',c>this.viewportDimensions.x/2);}}},_adjustTooltips:function(){var a=DOM.scry(this.rootEl,'a.fbNubButton.uiTooltip');a.each(this._adjustTooltip.bind(this));},_findFlyout:function(a){return (flyoutEl=CSS.hasClass(a,'fbNubFlyout')?a:DOM.scry(a,'div.fbNubFlyout')[0]||null);},registerNubController:function(b,a){DataStore.set(b,'dock:nub:controller',a);a.subscribe(a.FLYOUT_CONTENT_CHANGED,this._resizeNubFlyout.bind(this,b));},unregisterNubController:function(a){DataStore.remove(a,'dock:nub:controller');},notifyNub:function(c,d,b){var a=DataStore.get(c,'dock:nub:controller');return a&&a.inform(d,b)!==false;},_getNubContainer:function(a,b){var c=DOM.scry(this.rootEl,'div.fbDock .'+a)[0];if(!c&&b)c=DOM[a==='lNubContainer'?'prependContent':'appendContent'](this.rootEl.firstChild,HTML('<div class="'+a+'"></div>'))[0];return c||null;},_getLeftNubContainer:function(a){return (this.leftNubContainer=this.leftNubContainer||this._getNubContainer('lNubContainer',a));},_getRightNubContainer:function(a){return (this.rightNubContainer=this.rightNubContainer||this._getNubContainer('rNubContainer',a));},registerStateItem:function(d,e,f){var c=e==='left'?this._getLeftNubContainer(true):this._getRightNubContainer(true);if(!c.firstChild){var a=e==='left'?'fbDockWrapperRight':'fbDockWrapperLeft';CSS.removeClass(this.rootEl,a);}var b=f?'lastChild':'firstChild';while(d[b]){this.stateItems.push(d[b]);DOM[f?'prependContent':'appendContent'](c,d[b]);}DOM.remove(d);this._adjustTooltips();},registerStateItems:function(){this.subscribe('init',function(){var a=window.DockStateItems;while(a&&a.length)this.registerStateItem.apply(this,a.shift());}.bind(this));},_flushDockState:function(){this.stateItems.each(DOM.remove);this.stateItems=[];var a=this._getLeftNubContainer();if(a&&!a.firstChild)CSS.addClass(this.rootEl,'fbDockWrapperRight');var b=this._getRightNubContainer();if(b&&!b.firstChild)CSS.addClass(this.rootEl,'fbDockWrapperLeft');},_isRTL:function(){if(typeof this._rtl==='undefined')this._rtl=intl_locale_is_rtl();return this._rtl;}});
function NubController(){}Class.mixin(NubController,'Arbiter',{FLYOUT_CONTENT_CHANGED:'nub/flyout/content-changed',init:function(a){this.el=a;Dock.registerNubController(a,this);},flyoutContentChanged:function(){this.inform(this.FLYOUT_CONTENT_CHANGED);},hide:function(){Dock.hide(this.el);},show:function(){Dock.show(this.el);}});
function SimpleDrag(a){Event.listen(a,'mousedown',this._start.bind(this));}Class.mixin(SimpleDrag,'Arbiter',{_start:function(event){this.inform('start',event);var b=ua.ie()<9?document.documentElement:window;var a=Event.listen(b,{selectstart:Event.prevent,mousemove:this.inform.bind(this,'update'),mouseup:function(event){for(var c in a)a[c].remove();this.inform('end',event);}.bind(this)});return false;}});
function is_rtl(c){for(var b=0;b<c.length;b++){var a=c.charCodeAt(b);if(a>=48)return a>=1470&&a<=1920;}return false;}
onloadRegister(function(){copy_properties(AsyncRequest.prototype,{_checkCache:function(){if(this.method=='POST')return false;var c=this.uri.addQueryData(this.data).toString();var a=AsyncRequest._reqsCache[c];if(!this._isPrefetch&&a){var b=(+new Date())-a._start_time;if(b<a._cacheTTL){if(a._isPrefetch){this._cacheHit(c,b);a._isPrefetch=false;}else{a.replayResponses();this._cacheHit(c,a._saved_time);}return true;}else{delete AsyncRequest._reqsCache[c];return false;}}if(this._isPrefetch)if(!a){AsyncRequest._reqsCache[c]=this;this._start_time=(+new Date());this.uri.addQueryData({prefetch:true});return false;}else return true;return false;},_cacheHit:function(b,a){new AsyncSignal('/ajax/cache_hit.php',{path:URI(b).getPath(),key:this.data.key?this.data.key:'unknown',saved_time:a}).send();},_measureSaved:function(){if(this._start_time&&!this._saved_time)this._saved_time=(+new Date())-this._start_time;},_cacheTTL:300000});});
var Emote={_initialized:false,_imageBase:null,_emoteMap:null,_emoteOrderMap:null,_imageURLs:null,_regex:null,_mapOverlay:null,initExtraEmoticons:function(a){Emote._mapOverlay=a;},_init:function(){var f=env_get('static_base');Emote._imageBase=f+'images/emote/';Emote._blankImgSrc=f+'images/blank.gif';var a=['smile','frown','tongue','grin','gasp','wink','glasses','sunglasses','grumpy','unsure','cry','devil','angel','kiss','heart','kiki','squint','confused','upset','pacman','colonthree','like'];Emote._emoteMap={':-)':['\\:\\-\\)','smile'],':)':['\\:\\)','smile'],':]':['\\:\\]','smile'],'=)':['=\\)','smile'],':-(':['\\:\\-\\(','frown'],':(':['\\:\\(','frown'],':[':['\\:\\[','frown'],'=(':['=\\(','frown'],':-P':['\\:\\-P','tongue'],':P':['\\:P','tongue'],':-p':['\\:\\-p','tongue'],':p':['\\:p','tongue'],'=P':['=P','tongue'],':-D':['\\:\\-D','grin'],':D':['\\:D','grin'],'=D':['=D','grin'],':-O':['\\:\\-O','gasp'],':O':['\\:O','gasp'],':-o':['\\:\\-o','gasp'],':o':['\\:o','gasp'],';-)':['\\;\\-\\)','wink'],';)':['\\;\\)','wink'],'8-)':['8\\-\\)','glasses'],'8)':['8\\)','glasses'],'B-)':['B\\-\\)','glasses'],'B)':['B\\)','glasses'],'8-|':['8\\-\\|','sunglasses'],'8|':['8\\|','sunglasses'],'B-|':['B\\-\\|','sunglasses'],'B|':['B\\|','sunglasses'],'>:(':['>\\:\\(','grumpy'],'>:-(':['>\\:\\-\\(','grumpy'],':/':['\\:/','unsure'],':-/':['\\:\\-/','unsure'],':\\':['\\:\\\\','unsure'],':-\\':['\\:\\-\\\\','unsure'],":'(":["\\:'\\(",'cry'],'3:)':['3\\:\\)','devil'],'3:-)':['3\\:\\-\\)','devil'],'O:)':['O\\:\\)','angel'],'O:-)':['O\\:\\-\\)','angel'],':-*':['\\:\\-\\*','kiss'],':*':['\\:\\*','kiss'],'<3':['<3','heart'],'&lt;3':['&lt\\;3','heart'],'\u2665':['\u2665','heart'],'^_^':['\\^_\\^','kiki'],'-_-':['\\-_\\-','squint'],'o.O':['o\\.O','confused'],'O.o':['O\\.o','confused'],'>:O':['>\\:O','upset'],'>:-O':['>\\:\\-O','upset'],'>:o':['>\\:o','upset'],'>:-o':['>\\:\\-o','upset'],'>_<':['>_<','upset'],'>.<':['>\\.<','upset'],':v':['\\:v','pacman'],':|]':['\\:\\|\\]','robot'],':3':['\\:3','colonthree'],'<(")':['<\\(\\"\\)','penguin'],':putnam:':['\\:putnam\\:','putnam'],'(^^^)':['\\(\\^\\^\\^\\)','shark'],':42:':['\\:42\\:','42'],'(y)':['\\(y\\)','like'],'(Y)':['\\(Y\\)','like']};if(Emote._mapOverlay)copy_properties(Emote._emoteMap,Emote._mapOverlay);var d=[];for(var c in Emote._emoteMap)d.push(Emote._emoteMap[c][0]);var e='(?:^|\\s|\'|"|\\.)('+d.join('|')+')(?:\\s|\'|"|\\.|,|!|\\?|<br>|$)';Emote._regex=new RegExp(e);Emote._emoteOrderMap={};for(var b=0;b<a.length;b++)Emote._emoteOrderMap[a[b]]=b;Emote._initialized=true;},htmlEmote:function(j,l){if(typeof l!='function')l=htmlize;if(!Emote._initialized)Emote._init();var i=0;var k=j;var h=[];while(true){var e=Emote._regex.exec(k);if(!e||!e.length)break;var b=e[1];var d=Emote._emoteMap[b][1];var c=k.indexOf(b);var a=k.substring(0,c);if(a)h.push(l(a));h.push('<span class="emote_text">');h.push(b);h.push('</span><img ');var f;if(typeof(f=Emote._emoteOrderMap[d])=='undefined'){h.push('class="emote_custom" src="');h.push(Emote._imageBase);h.push(d);h.push('.gif" ');}else{var g=f*-16;h.push('class="emote_img" src="');h.push(Emote._blankImgSrc);h.push('" style="background-position: ');h.push(g);h.push('px 0px" ');}h.push('alt="');h.push(b);h.push('" />');k=k.substring(c+b.length);}if(k)h.push(l(k));return h.join('');}};
var Sound=(function(){var a=false;var b='so_sound_player';function c(e){var f=URI(e);if(!f.getDomain())return URI(env_get('static_base')).setPath(f.getPath()).toString();return e;}function d(){var e=document[b]||window[b];if(e)if(!e.playSound&&e.length)e=e[0];return (e&&e.playSound&&e.loopSound)?e:null;}return {init:function(){if(a)return;a=true;var e=document.createElement('div');e.id='sound_player_holder';document.body.appendChild(e);try{var player=new SWFObject('/swf/SoundPlayer.swf',b,'1px','1px',['9.0.159.0','10.0.22.87'],'#ffffff');player.addParam('allowscriptaccess','always');player.addParam('wmode','transparent');player.addVariable('swf_id',b);player.fallback_html=' ';player.write(e.id);window[b]=player;}catch(f){}},play:function(h,j,g,f){Sound.init();h=c(h);var i=d();if(/\.mp3$/.test(h)&&i){if(g){i.loopSound(h,j);}else i.playSound(h,j);}else{if(f)return;var e=ge('sound');if(!e){e=document.createElement('span');e.setAttribute('id','sound');DOM.getRootElement().appendChild(e);}e.innerHTML='<embed src="'+h+'" autostart="true" loop="'+(g?'true':'false')+'" hidden="true" />';}},stop:function(f){f=c(f);var g=d();g&&g.stopSound(f);var e=ge('sound');e&&(e.innerHTML='');}};})();
(function(){var c=new Date();var a=2000;var b=10000;function d(){var f=new Date();var e=f-c-a;c=f;if(e>b)Arbiter.inform('time_check',e);}setInterval(d,a);})();
add_properties('Messaging',{getUserThreadURI:function(a){return URI(env_get('www_base')).setPath('/messages/'+a);},getInboxThreadURI:function(a){return URI(env_get('www_base')).setPath('/messages/?action=read&tid='+a);},markAsRead:function(a){a=$A(a);new AsyncRequest().setURI('/ajax/messaging/async.php').setData({action:'markRead',tids:a}).setMethod('POST').setHandler(bagofholding).setErrorHandler(bagofholding).send();MessagingEvents.inform('mark-as-read',{tids:a});},markUserThreadAsRead:function(a){new AsyncRequest().setURI('/ajax/messaging/async.php').setData({action:'chatMarkRead',other_user:a}).setMethod('POST').setHandler(bagofholding).setErrorHandler(bagofholding).send();MessagingEvents.inform('mark-as-read',{chat_ids:[a]});},unsubscribeFromThread:function(a){new AsyncRequest().setURI('/ajax/messaging/async.php').setData({action:'unsubscribe',tids:a}).setMethod('POST').setHandler(bagofholding).setErrorHandler(bagofholding).send();},emoteContent:function(b,c){for(var a=0;a<b.length;a++)this._emoteNode(b[a],c);},_emoteNode:function(f,h){if(!DOM.isNode(f,'#text')){var a=$A(f.childNodes);for(var d=0;d<a.length;d++)this._emoteNode(a[d],h);return;}var g=f.nodeValue;if(h)g=f.nodeValue.replace(/\n/g," ");var b=Emote.htmlEmote(g);if(!b||b==f.nodeValue)return;var c=HTML(b).getNodes();if(!c||!c.length)return;for(var e=c.length;e--;)DOM.insertAfter(f,c[e]);DOM.remove(f);}});
function ScrollableArea(){}copy_properties(ScrollableArea,{getInstance:function(a){var b=Parent.byClass(a,'uiScrollableArea');return b?DataStore.get(b,'ScrollableArea'):null;}});ScrollableArea.prototype={init:function(a,b){b=b||{};this._elem=a;this._body=DOM.find(a,'div.uiScrollableAreaBody');this._content=DOM.find(this._body,'div.uiScrollableAreaContent');this._track=DOM.find(a,'div.uiScrollableAreaTrack');this._gripper=DOM.find(this._track,'div.uiScrollableAreaGripper');this._options=b;this.adjustGripper();this._listeners=[Event.listen(this._body,'scroll',this._handleScroll.bind(this))];if(b.fade!==false)this._listeners.push(Event.listen(a,'mouseenter',this.showScrollbar.shield(this)),Event.listen(a,'mousemove',this._handleMousemove.bind(this)),Event.listen(a,'mouseout',this.hideScrollbar.shield(this)),Event.listen(a,'mouseover',this.adjustGripper.shield(this)));this.initDrag();DataStore.set(this._elem,'ScrollableArea',this);if(!b.persistent)onleaveRegister(this.destroy.bind(this));},initDrag:function(){var a=new SimpleDrag(this._gripper);a.subscribe('start',function(b,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;var d=this._getPageY(event);var e=this._gripper.offsetTop;var f=a.subscribe('update',function(g,event){var j=this._getPageY(event)-d;var h=this._elem.clientHeight;var i=this._content.offsetHeight;var p=this._track.offsetHeight;var k=h/i*p;var m=i-this._body.offsetHeight;var l=e+j;var n=p-k;l=Math.max(Math.min(l,n),0);var o=l/n*m;this._body.scrollTop=o;}.bind(this));var c=a.subscribe('end',function(){a.unsubscribe(f);a.unsubscribe(c);});}.bind(this));},adjustGripper:function(){var a=this._elem.clientHeight;var b=this._content.offsetHeight;var e=this._track.offsetHeight;var c=a/b*e;if(c<e){CSS.setStyle(this._gripper,'height',c+'px');var d=this._body.scrollTop/b*e;CSS.setStyle(this._gripper,'top',d+'px');CSS.show(this._gripper);}else CSS.hide(this._gripper);return this;},destroy:function(){this._listeners.forEach(function(a){a.remove();});this._listeners.length=0;},_getPageX:function(event){return event.pageX!=null?event.pageX:event.clientX+document.body.scrollLeft;},_getPageY:function(event){return event.pageY!=null?event.pageY:event.clientY+document.body.scrollTop;},_handleMousemove:function(event){var a=Vector2.getElementPosition(this._track).x;var b=Vector2.getElementDimensions(this._track).x;if(Math.abs(a+b/2-this._getPageX(event))<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false){this.showScrollbar();this.hideScrollbar();}},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=animation(this._track).from('opacity',1).to('opacity',0).duration(250).go();}.bind(this).defer(750);return this;},showScrollbar:function(a){if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}CSS.setStyle(this._track,'opacity',1);if(a!==false)this.hideScrollbar();return this;},scrollToBottom:function(){animation(this._body).to('scrollTop',this._body.scrollHeight).ease(animation.ease.end).go();}};onloadRegister(function(){Event.listen(document.documentElement,ua.firefox()?'DOMMouseScroll':'mousewheel',function(event){var a=Parent.byClass(event.getTarget(),'uiScrollableAreaBody');if(!a)return;if((typeof event.axis!=='undefined'&&event.axis===event.HORIZONTAL_AXIS)||(event.wheelDeltaX&&!event.wheelDeltaY)){event.prevent();return;}var c=event.wheelDelta?event.wheelDelta:-event.detail;var f=a.scrollHeight;var b=a.clientHeight;if(f>b){var g=a.scrollTop;if((c>0&&g===0)||(c<0&&g>=f-b)){event.prevent();}else if(ua.ie()<9){var e=CSS.getStyle(a,'font-size');if(e.indexOf('px')<0){var d=$N('div');d.style.fontSize=e;d.style.height='1em';e=d.style.pixelHeight;}else e=parseInt(e,10);a.scrollTop=g-Math.round(c/120*e);event.prevent();}}});});
function CreditsBalanceUpdater(){}CreditsBalanceUpdater.UPDATE='creditsBalance/update';CreditsBalanceUpdater.negBalance='negativeBalance';CreditsBalanceUpdater.repay='needsRepayment';CreditsBalanceUpdater.prototype={init:function(b,a){this.root=b;this.targetBalance=DOM.find(this.root,'span.creditsBalance');Arbiter.inform(CreditsBalanceUpdater.UPDATE,a,Arbiter.BEHAVIOR_STATE);Arbiter.subscribe(CreditsBalanceUpdater.UPDATE,this.oninform.bind(this),Arbiter.SUBSCRIBE_NEW);new LiveMessageReceiver('update_canvas_balance').setHandler(this.oninform_livemessage.bind(this)).register();},oninform_livemessage:function(a){this.oninform(CreditsBalanceUpdater.UPDATE,a);},oninform:function(c,b){if(c==CreditsBalanceUpdater.UPDATE){var a=ge('get_more_link');if(b>=0){CSS.removeClass(this.root,CreditsBalanceUpdater.negBalance);a&&CSS.removeClass(a,CreditsBalanceUpdater.repay);}else{CSS.addClass(this.root,CreditsBalanceUpdater.negBalance);a&&CSS.addClass(a,CreditsBalanceUpdater.repay);}DOM.setContent(this.targetBalance,b);}}};